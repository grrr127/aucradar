{% extends "core/base.html" %}

{% block title %}AucRadar | 프로필{% endblock %}

{% block extra_head %}
<style>
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px}
  .card.small{padding:18px}
  .formgrid{display:grid;gap:10px}
  label{font-weight:900;font-size:14px;display:block;margin-bottom:5px;}
  input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#0b1020;color:var(--text);font-size:14px; outline:none;}
  .item{padding:12px 14px;border-radius:14px;border:1px solid var(--line);background: rgba(255,255,255,.03);margin-bottom:10px;}
  .badge.success{color:#67f0c8; font-size:11px;}
  .badge.failed{color:#ff6b6b; font-size:11px;}
  @media (max-width:900px){.grid2{grid-template-columns:1fr}}
</style>
{% endblock %}

{% block content %}
<section class="card small">
  <h1 class="h1" style="font-size:28px;">내 프로필</h1>
  <p class="sub">가입일: {{ user.date_joined|date:"Y년 m월 d일" }}</p>
</section>

<section class="grid2">
  <div class="card small">
    <p class="title" style="margin:0 0 10px;">계정 정보</p>
    <form method="post" action="#" class="formgrid">
      {% csrf_token %}
      <div>
        <label>이메일</label>
        <input type="email" value="{{ user.email }}" readonly style="opacity:0.6;">
      </div>
      <div>
        <label>이름</label>
        <input type="text" name="name" value="{{ user.name }}" placeholder="이름을 입력하세요">
      </div>
      <div style="margin-top:10px;">
        <button type="submit" class="btn primary">정보 수정</button>
      </div>
    </form>
  </div>

  <div class="card small">
    <p class="title" style="margin:0 0 10px;">최근 알림 발송 로그</p>
    <div class="list" style="max-height: 400px; overflow-y: auto;">
      {% for log in user.notification_logs.all|slice:":10" %} <div class="item">
        <div style="display:flex; justify-content:space-between;">
          <b>{{ log.message_title|truncatechars:20 }}</b>
          <span class="badge {{ log.status }}">
            {{ log.get_channel_display }} {{ log.get_status_display }}
          </span>
        </div>
        <p style="font-size:12px; margin-top:4px;">{{ log.created_at|date:"m-d H:i" }} 발송</p>
      </div>
      {% empty %}
      <div class="empty" style="font-size:13px; color:var(--muted);">발송된 알림 내역이 없습니다.</div>
      {% endfor %}
    </div>
  </div>
</section>

<section class="card small section">
  <p class="title" style="margin:0 0 10px;">보안 및 기타</p>
  <div class="actions">
    <a class="btn" href="#">비밀번호 변경</a>
    <form action="{% url 'accounts:logout' %}" method="post" style="display:inline;">
      {% csrf_token %}
      <button type="submit" class="btn" style="color:var(--danger); border-color:var(--danger);">로그아웃</button>
    </form>
  </div>
</section>
{% endblock %}