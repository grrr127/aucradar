{% extends "core/base.html" %}
{% block title %}AucRadar | 비밀번호 재설정{% endblock %}

{% block content %}
<section class="card" style="margin-top:22px; max-width:520px; margin-left:auto; margin-right:auto; {% if state in 'done complete' %}text-align:center;{% endif %}">
    {% if state == "done" %}
    <h1 class="h1" style="font-size:30px;">이메일을 확인해주세요</h1>
    <p class="sub" style="margin-bottom:16px">
        입력하신 주소로 비밀번호 재설정 링크를 보냈습니다.<br/>
        몇 분 내로 메일이 도착하지 않으면 스팸함을 확인하거나 다시 시도해 주세요.
    </p>

    <div class="cta" style="justify-content:center;">
        <a class="btn primary" href="/accounts/login/">로그인으로 돌아가기</a>
        <a class="btn" href="/contact/">문의하기</a>
    </div>

    {% elif state == "confirm" %}
    <h1 class="h1" style="font-size:30px;">새 비밀번호 설정</h1>
    <p clss="sub">
        아래에 새 비밀번호를 입력해 주세요.<br/>
        안전한 새 계정을 위해 다른 서비스에서 사용하지 않은 비밀번호를 추천합니다.
    </p>

    {% if validlink %}
    <form method="post" style="display:grid; gap:12px; margin-top:14px;">
      {% csrf_token %}

      <div class="feature">
        <b>새 비밀번호</b>
        {{ form.new_password1 }}
        {% if form.new_password1.errors %}<p style="color:var(--danger); margin:8px 0 0;">{{ form.new_password1.errors|striptags }}</p>{% endif %}
      </div>

      <div class="feature">
        <b>새 비밀번호 확인</b>
        {{ form.new_password2 }}
        {% if form.new_password2.errors %}<p style="color:var(--danger); margin:8px 0 0;">{{ form.new_password2.errors|striptags }}</p>{% endif %}
      </div>

      {% if form.non_field_errors %}
        <div class="feature" style="border-color: rgba(255,107,107,.35);">
          <p style="color:var(--danger); margin:0;">{{ form.non_field_errors|striptags }}</p>
        </div>
      {% endif %}

      <button class="btn primary" type="submit" style="width:100%;">비밀번호 변경</button>
    </form>
    {% else %}
    <div class="feature" style="border-color: rgba(255,107,107,.35);">
      <p style="color:var(--danger); margin:0;">링크가 만료되었거나 유효하지 않습니다. 다시 요청해 주세요.</p>
    </div>
    <div class="cta" style="margin-top:14px;">
      <a class="btn primary" href="{% url 'password_reset' %}">재설정 메일 다시 받기</a>
      <a class="btn" href="/accounts/login/">로그인으로 돌아가기</a>
    </div>
    {% endif %}

  {% elif state == "complete" %}
    <h1 class="h1" style="font-size:30px;">비밀번호가 변경되었습니다</h1>
    <p class="sub" style="margin-bottom:16px;">
      새 비밀번호로 로그인할 수 있습니다.<br/>
      계정 보안을 위해 주기적으로 비밀번호를 변경해 주세요.
    </p>

    <div class="cta" style="justify-content:center;">
      <a class="btn primary" href="/accounts/login/">로그인하러 가기</a>
      <a class="btn" href="/dashboard/">대시보드로 이동</a>
    </div>

  {% else %}
    <h1 class="h1" style="font-size:30px;">비밀번호 재설정</h1>
    <p class="sub">
      가입 시 사용한 이메일 주소를 입력하시면<br>
      비밀번호 재설정 링크를 보내드립니다.
    </p>

    <form method="post">
      {% csrf_token %}

      <div class="feature">
        <b>이메일 주소</b>
        {{ form.email }}
      </div>

      <div class="cta" style="margin-top:14px;">
        <button class="btn primary" type="submit">재설정 메일 보내기</button>
        <a class="btn" href="/accounts/login/">로그인으로 돌아가기</a>
      </div>
    </form>
  {% endif %}
</section>
{% endblock %}
